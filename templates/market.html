{% extends "base.html" %}
{% load static %}

{% block title %}–ë–∏—Ä–∂–∞ –∏ –ü–æ—Ä—Ç—Ñ–µ–ª—å{% endblock %}
{% block header_title %}<span id="user-display">–ü–æ—Ä—Ç—Ñ–µ–ª—å</span>{% endblock %}

{% block content %}
    <div class="portfolio-section" id="portfolio-view">
        <div class="summary-box">
            <p>–ë–∞–ª–∞–Ω—Å: <strong id="balance-display"></strong> RUB</p>
            <p>–°—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤: <strong id="market-value-display"></strong> RUB</p>
            <p>–û–±—â–∞—è P&L: <strong id="pnl-display"></strong></p>
        </div>

        <h3>üõí –°–æ–≤–µ—Ä—à–∏—Ç—å —Å–¥–µ–ª–∫—É</h3>
        <form id="trade-form" class="trade-form">
            <input type="text" id="ticker" placeholder="–¢–∏–∫–µ—Ä (–Ω–∞–ø—Ä., SBER)" required>
            <input type="number" id="quantity" placeholder="–ö–æ–ª-–≤–æ (–ª–æ—Ç)" required min="1">
            <button type="button" onclick="handleTrade('buy')">–ü–æ–∫—É–ø–∫–∞</button>
            <button type="button" onclick="handleTrade('sell')">–ü—Ä–æ–¥–∞–∂–∞</button>
        </form>

        <h3>–í–∞—à–∏ –∞–∫—Ç–∏–≤—ã</h3>
        <table id="assets-table">
            <thead>
                <tr><th>–¢–∏–∫–µ—Ä</th><th>–ö–æ–ª-–≤–æ</th><th>–°—Ä. —Ü–µ–Ω–∞</th><th>–¢–µ–∫. —Ü–µ–Ω–∞</th><th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th><th>P&L</th><th>P&L %</th><th>–õ–æ—Ç</th></tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="history-section">
            <div class="history-header" onclick="toggleHistory()">
                <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
                <span id="history-arrow" class="arrow">‚ñº</span>
            </div>
            <div id="history-content" style="display: none;">
                <table id="history-table">
                    <thead>
                        <tr><th>–î–∞—Ç–∞</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th><th>–¢–∏–∫–µ—Ä</th><th>–ö–æ–ª-–≤–æ</th><th>–¶–µ–Ω–∞</th><th>–°—É–º–º–∞</th><th>–ö–æ–º–∏—Å—Å–∏—è</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/market.js' %}"></script>
<script>
    window.onload = checkAuthAndLoadMarket;
</script>
{% endblock %}